

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>xLearn Python API Guide &mdash; xLearn 0.1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="xLearn 0.1.0 documentation" href="index.html"/>
        <link rel="next" title="xLearn Demo" href="demo.html"/>
        <link rel="prev" title="xLearn Command Line Guide" href="command_line.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> xLearn
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_line.html">xLearn Command Line Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">xLearn Python API Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="#choose-machine-learning-model">Choose Machine Learning Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-dataset">Set Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cross-validation">Cross Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#choose-optimization-method">Choose Optimization Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hyper-parameter-tuning">Hyper-parameter Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-epoch-number-and-early-stopping">Set Epoch Number and Early Stopping</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lock-free-training">Lock-Free Training</a></li>
<li class="toctree-l2"><a class="reference internal" href="#instance-wise-normalization">Instance-Wise Normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quiet-training">Quiet Training</a><ul class="simple">
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="demo.html">xLearn Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">xLearn Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">xLearn</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>xLearn Python API Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/python_api.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="xlearn-python-api-guide">
<h1>xLearn Python API Guide<a class="headerlink" href="#xlearn-python-api-guide" title="Permalink to this headline">¶</a></h1>
<p>xLearn supports very easy-to-use python API for users. Once you install the
xLearn python package successfully, you can try it! Type <code class="docutils literal"><span class="pre">python</span></code> in your
shell and perform the following python code to check your installation:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xlearn</span> <span class="k">as</span> <span class="nn">xl</span>
<span class="n">xl</span><span class="o">.</span><span class="n">hello</span><span class="p">()</span>
</pre></div>
</div>
<p>Output</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>-------------------------------------------------------------------------
         _
        | |
   __  _| |     ___  __ _ _ __ _ __
   \ \/ / |    / _ \/ _` | &#39;__| &#39;_ \
    &gt;  &lt;| |___|  __/ (_| | |  | | | |
   /_/\_\_____/\___|\__,_|_|  |_| |_|

      xLearn   -- 0.10 Version --
-------------------------------------------------------------------------
</pre></div>
</div>
<div class="section" id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p>Here is a simple python demo no how to use xLearn. You can check out the demo data
(<code class="docutils literal"><span class="pre">small_train.txt</span></code> and <code class="docutils literal"><span class="pre">small_test.txt</span></code>) from the path <code class="docutils literal"><span class="pre">demo/classification/criteo_ctr</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xlearn</span> <span class="kn">as</span> <span class="nn">xl</span>

<span class="c1"># Training task</span>
<span class="n">ffm_model</span> <span class="o">=</span> <span class="n">xl</span><span class="o">.</span><span class="n">create_ffm</span><span class="p">()</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">setTrain</span><span class="p">(</span><span class="s2">&quot;./small_train.txt&quot;</span><span class="p">)</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">setValidate</span><span class="p">(</span><span class="s2">&quot;./small_test.txt&quot;</span><span class="p">)</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.002</span><span class="p">}</span>

<span class="n">ffm_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="s2">&quot;./model.out&quot;</span><span class="p">)</span>

<span class="c1"># Prediction task</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">setTest</span><span class="p">(</span><span class="s2">&quot;./small_test.txt&quot;</span><span class="p">)</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">&quot;./model.out&quot;</span><span class="p">,</span> <span class="s2">&quot;./output.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, we show a portion of the xLearn’s output</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Epoch</span>      <span class="n">Train</span> <span class="n">log_loss</span>       <span class="n">Test</span> <span class="n">log_loss</span>     <span class="n">Time</span> <span class="n">cost</span> <span class="p">(</span><span class="n">sec</span><span class="p">)</span>
    <span class="mi">1</span>            <span class="mf">0.593750</span>            <span class="mf">0.535847</span>                <span class="mf">0.00</span>
    <span class="mi">2</span>            <span class="mf">0.539226</span>            <span class="mf">0.543829</span>                <span class="mf">0.00</span>
    <span class="mi">3</span>            <span class="mf">0.520034</span>            <span class="mf">0.531732</span>                <span class="mf">0.00</span>
    <span class="mi">4</span>            <span class="mf">0.505186</span>            <span class="mf">0.537418</span>                <span class="mf">0.00</span>
    <span class="mi">5</span>            <span class="mf">0.494089</span>            <span class="mf">0.533448</span>                <span class="mf">0.00</span>
    <span class="mi">6</span>            <span class="mf">0.483678</span>            <span class="mf">0.534629</span>                <span class="mf">0.00</span>
    <span class="mi">7</span>            <span class="mf">0.470848</span>            <span class="mf">0.528086</span>                <span class="mf">0.00</span>
    <span class="mi">8</span>            <span class="mf">0.466330</span>            <span class="mf">0.533253</span>                <span class="mf">0.00</span>
    <span class="mi">9</span>            <span class="mf">0.456660</span>            <span class="mf">0.535635</span>                <span class="mf">0.00</span>
<span class="n">Early</span><span class="o">-</span><span class="n">stopping</span> <span class="n">at</span> <span class="n">epoch</span> <span class="mi">7</span>
</pre></div>
</div>
<p>In this example, we use FFM to train our model within 9 epoch for a binary classification
task. If you want train a regression model. You can reset the <code class="docutils literal"><span class="pre">task</span></code> parameter to <code class="docutils literal"><span class="pre">reg</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;reg&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.002</span><span class="p">}</span>
</pre></div>
</div>
<p>We can see that a new file called <code class="docutils literal"><span class="pre">model.out</span></code> has been generated in current directory.
This file stores the trainned model checkpoint, and we can use this model file to make
prediction in the future</p>
<p>After we perform the python code</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ffm_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">&quot;./model.out&quot;</span><span class="p">,</span> <span class="s2">&quot;./output.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>we can get a new file called <code class="docutils literal"><span class="pre">output.txt</span></code> in current directory. This is output prediction
result. Let’s see the first five lines of output by using the following command</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">head</span> <span class="o">-</span><span class="n">n</span> <span class="mi">5</span> <span class="o">./</span><span class="n">output</span><span class="o">.</span><span class="n">txt</span>

<span class="o">-</span><span class="mf">1.5927</span>
<span class="o">-</span><span class="mf">0.560985</span>
<span class="o">-</span><span class="mf">0.773492</span>
<span class="o">-</span><span class="mf">0.551364</span>
<span class="o">-</span><span class="mf">1.22954</span>
</pre></div>
</div>
<p>These five lines of data is the prediction score calculated for every example in test set. The
negative data represents the negative example and the positive data prepresents the positive example.
You can convert the score to <code class="docutils literal"><span class="pre">(0-1)</span></code> by using <code class="docutils literal"><span class="pre">setSigmoid()</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Prediction task</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">setTest</span><span class="p">(</span><span class="s2">&quot;./small_test.txt&quot;</span><span class="p">)</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">setSigmoid</span><span class="p">()</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">&quot;./model.out&quot;</span><span class="p">,</span> <span class="s2">&quot;./output.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>and then we can get the result</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">head</span> <span class="o">-</span><span class="n">n</span> <span class="mi">5</span> <span class="o">./</span><span class="n">output</span><span class="o">.</span><span class="n">txt</span>

<span class="mf">0.162849</span>
<span class="mf">0.352197</span>
<span class="mf">0.308373</span>
<span class="mf">0.356715</span>
<span class="mf">0.217436</span>
</pre></div>
</div>
<p>We can also convert the score to binary result <code class="docutils literal"><span class="pre">(0</span> <span class="pre">and</span> <span class="pre">1)</span></code> by using <code class="docutils literal"><span class="pre">setSign()</span></code> API</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Prediction task</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">setTest</span><span class="p">(</span><span class="s2">&quot;./small_test.txt&quot;</span><span class="p">)</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">setSign</span><span class="p">()</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="s2">&quot;./model.out&quot;</span><span class="p">,</span> <span class="s2">&quot;./output.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">head</span> <span class="o">-</span><span class="n">n</span> <span class="mi">5</span> <span class="o">./</span><span class="n">output</span><span class="o">.</span><span class="n">txt</span>

<span class="mi">0</span>
<span class="mi">0</span>
<span class="mi">0</span>
<span class="mi">0</span>
<span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="choose-machine-learning-model">
<h2>Choose Machine Learning Model<a class="headerlink" href="#choose-machine-learning-model" title="Permalink to this headline">¶</a></h2>
<p>For now, xLearn can support three different machine learning models, including
LR, FM, and FFM. Users can create different models by using <code class="docutils literal"><span class="pre">create_xxx()</span></code> API.
For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xlearn</span> <span class="k">as</span> <span class="nn">xl</span>

<span class="n">ffm_model</span> <span class="o">=</span> <span class="n">xl</span><span class="o">.</span><span class="n">create_ffm</span><span class="p">()</span>
<span class="n">fm_model</span> <span class="o">=</span> <span class="n">xl</span><span class="o">.</span><span class="n">create_fm</span><span class="p">()</span>
<span class="n">lr_model</span> <span class="o">=</span> <span class="n">xl</span><span class="o">.</span><span class="n">create_lr</span><span class="p">()</span>
</pre></div>
</div>
<p>For LR and FM, the input data can be <code class="docutils literal"><span class="pre">CSV</span></code> or <code class="docutils literal"><span class="pre">libsvm</span></code> data format, while for FFM, the
input data should be the <code class="docutils literal"><span class="pre">libffm</span></code> format. You can give a <code class="docutils literal"><span class="pre">libffm</span></code> file to LR and FM. At
that time, xLearn will treat this data as <code class="docutils literal"><span class="pre">libsvm</span></code> format.</p>
</div>
<div class="section" id="set-dataset">
<h2>Set Dataset<a class="headerlink" href="#set-dataset" title="Permalink to this headline">¶</a></h2>
<p>Users can set dataset by using <code class="docutils literal"><span class="pre">setTrain()</span></code>, <code class="docutils literal"><span class="pre">setTest()</span></code>, and <code class="docutils literal"><span class="pre">setValidate()</span></code> dataset.
The <code class="docutils literal"><span class="pre">setTrain()</span></code> and <code class="docutils literal"><span class="pre">setValidate()</span></code> are used for training task, while the <code class="docutils literal"><span class="pre">setTest()</span></code>
is used for prediction task. If users don’t set the validation file, xLearn will not calculate
any evaluation metric. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xlearn</span> <span class="k">as</span> <span class="nn">xl</span>

<span class="c1"># Training task</span>
<span class="n">ffm_model</span> <span class="o">=</span> <span class="n">xl</span><span class="o">.</span><span class="n">create_ffm</span><span class="p">()</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">setTrain</span><span class="p">(</span><span class="s2">&quot;./small_train.txt&quot;</span><span class="p">)</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.002</span><span class="p">}</span>

<span class="n">ffm_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="s2">&quot;./model.out&quot;</span><span class="p">)</span>


<span class="n">Epoch</span>      <span class="n">Train</span> <span class="n">log_loss</span>     <span class="n">Time</span> <span class="n">cost</span> <span class="p">(</span><span class="n">sec</span><span class="p">)</span>
    <span class="mi">1</span>            <span class="mf">0.593791</span>                <span class="mf">0.00</span>
    <span class="mi">2</span>            <span class="mf">0.540819</span>                <span class="mf">0.00</span>
    <span class="mi">3</span>            <span class="mf">0.518385</span>                <span class="mf">0.00</span>
    <span class="mi">4</span>            <span class="mf">0.504790</span>                <span class="mf">0.00</span>
    <span class="mi">5</span>            <span class="mf">0.492556</span>                <span class="mf">0.00</span>
    <span class="mi">6</span>            <span class="mf">0.481522</span>                <span class="mf">0.00</span>
    <span class="mi">7</span>            <span class="mf">0.473634</span>                <span class="mf">0.00</span>
    <span class="mi">8</span>            <span class="mf">0.464028</span>                <span class="mf">0.00</span>
    <span class="mi">9</span>            <span class="mf">0.456445</span>                <span class="mf">0.00</span>
   <span class="mi">10</span>            <span class="mf">0.448745</span>                <span class="mf">0.00</span>
</pre></div>
</div>
</div>
<div class="section" id="cross-validation">
<h2>Cross Validation<a class="headerlink" href="#cross-validation" title="Permalink to this headline">¶</a></h2>
<p>Cross-validation, sometimes called rotation estimation, is a model validation technique
for assessing how the results of a statistical analysis will generalize to an independent
data set. In xLearn, users can use <code class="docutils literal"><span class="pre">cv()</span></code> API to perform cross-validation. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xlearn</span> <span class="k">as</span> <span class="nn">xl</span>

<span class="c1"># Training task</span>
<span class="n">ffm_model</span> <span class="o">=</span> <span class="n">xl</span><span class="o">.</span><span class="n">create_ffm</span><span class="p">()</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">setTrain</span><span class="p">(</span><span class="s2">&quot;./small_train.txt&quot;</span><span class="p">)</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.002</span><span class="p">}</span>

<span class="n">ffm_model</span><span class="o">.</span><span class="n">cv</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</pre></div>
</div>
<p>On default, xLearn uses 5-folds cross validation, and users can set number of fold
by using the <code class="docutils literal"><span class="pre">fold</span></code> parameter in <code class="docutils literal"><span class="pre">param</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xlearn</span> <span class="k">as</span> <span class="nn">xl</span>

<span class="c1"># Training task</span>
<span class="n">ffm_model</span> <span class="o">=</span> <span class="n">xl</span><span class="o">.</span><span class="n">create_ffm</span><span class="p">()</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">setTrain</span><span class="p">(</span><span class="s2">&quot;./small_train.txt&quot;</span><span class="p">)</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.002</span><span class="p">,</span> <span class="s1">&#39;fold&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>

<span class="n">ffm_model</span><span class="o">.</span><span class="n">cv</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, xLearn performs cross-validation in 3 folds.</p>
</div>
<div class="section" id="choose-optimization-method">
<h2>Choose Optimization Method<a class="headerlink" href="#choose-optimization-method" title="Permalink to this headline">¶</a></h2>
<p>In xLearn, users can choose different optimization methods by using <code class="docutils literal"><span class="pre">opt</span></code> parameter. For now,
users can choose <code class="docutils literal"><span class="pre">sgd</span></code>, <code class="docutils literal"><span class="pre">adagrad</span></code>, and <code class="docutils literal"><span class="pre">ftrl</span></code> method. On default, xLearn uses the <code class="docutils literal"><span class="pre">adagrad</span></code>
method. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.002</span><span class="p">,</span> <span class="s1">&#39;opt&#39;</span><span class="p">:</span><span class="s1">&#39;sgd&#39;</span><span class="p">}</span>
<span class="c1"># param = {&#39;task&#39;:&#39;binary&#39;, &#39;lr&#39;:0.2, &#39;lambda&#39;:0.002, &#39;opt&#39;:&#39;adagrad&#39;}</span>
<span class="c1"># param = {&#39;task&#39;:&#39;binary&#39;, &#39;lr&#39;:0.2, &#39;lambda&#39;:0.002, &#39;opt&#39;:&#39;ftrl&#39;}</span>

<span class="n">ffm_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="s2">&quot;./model.out&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Compared to traditional <code class="docutils literal"><span class="pre">sgd</span></code> method, <code class="docutils literal"><span class="pre">adagrad</span></code> adapts the learning rate to the parameters, performing
larger updates for infrequent and smaller updates for frequent parameters. For this reason, it is well-suited
for dealing with sparse data. In addtion, sgd is more sensetive to the learning rate compared with adagrad.</p>
<p><code class="docutils literal"><span class="pre">FTRL</span></code> (Follow-the-Regularized-Leader) is also a famous method that has been widely used in large-scale sparse
problem. To use FTRL, users need to tune more hyperparameters compared with sgd and adagard.</p>
</div>
<div class="section" id="hyper-parameter-tuning">
<h2>Hyper-parameter Tuning<a class="headerlink" href="#hyper-parameter-tuning" title="Permalink to this headline">¶</a></h2>
<p>In machine learning, a <code class="docutils literal"><span class="pre">hyperparameter</span></code> is a parameter whose value is set before the learning process begins. By
contrast, the value of other parameters are derived via training. Hyperparameter tuning is the problem of choosing
a set of optimal hyperparameters for a learning algorithm.</p>
<p>First, <code class="docutils literal"><span class="pre">learning</span> <span class="pre">rate</span></code> is one of the most important hyperparameter used in machine learning. On default, this value
is <code class="docutils literal"><span class="pre">0.2</span></code>. For example, we can tune this value by using <code class="docutils literal"><span class="pre">lr</span></code> parameter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">}</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">}</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">}</span>

<span class="o">...</span>
</pre></div>
</div>
<p>We can also set the <code class="docutils literal"><span class="pre">lambda</span></code> parameter to perform regularization. On default, xLearn uses <code class="docutils literal"><span class="pre">L2</span></code> regularization, and the
regular lambda has been set to <code class="docutils literal"><span class="pre">0.00002</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">}</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.02</span><span class="p">}</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.002</span><span class="p">}</span>

<span class="o">...</span>
</pre></div>
</div>
<p>For FTRL method, we also need to tune another four hyperparameters, including <code class="docutils literal"><span class="pre">alpha</span></code>, <code class="docutils literal"><span class="pre">beta</span></code>, <code class="docutils literal"><span class="pre">lambda_1</span></code>,
and <code class="docutils literal"><span class="pre">lambda_2</span></code>. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mf">0.002</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">:</span><span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;lambda_1&#39;</span><span class="p">:</span><span class="mf">0.001</span><span class="p">,</span> <span class="s1">&#39;lambda_2&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>
</pre></div>
</div>
<p>For FM and FFM. users need to set the size of latent factor by using <code class="docutils literal"><span class="pre">k</span></code> parameters. On default, xLearn uses <code class="docutils literal"><span class="pre">4</span></code> for
this value.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">}</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">}</span>

<span class="o">...</span>
</pre></div>
</div>
<p>xLearn uses SSE instruction to accerlate vector operation, and hence the time cost for
<code class="docutils literal"><span class="pre">k=2</span></code> and <code class="docutils literal"><span class="pre">k=4</span></code> are the same.</p>
<p>For FM and FFM,  users can also set the hyperparameter <code class="docutils literal"><span class="pre">init</span></code> for model initialization.
On defualt, this value is <code class="docutils literal"><span class="pre">0.66</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;init&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">}</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;init&#39;</span><span class="p">:</span><span class="mf">0.8</span><span class="p">}</span>

<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="set-epoch-number-and-early-stopping">
<h2>Set Epoch Number and Early Stopping<a class="headerlink" href="#set-epoch-number-and-early-stopping" title="Permalink to this headline">¶</a></h2>
<p>Users can set the epoch number for training by using <code class="docutils literal"><span class="pre">epoch</span></code> parameter.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;epoch&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;epoch&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;epoch&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">}</span>

<span class="o">...</span>
</pre></div>
</div>
<p>While, if the validation file has been set, xLearn will perform early-stopping by default.
For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xlearn</span> <span class="k">as</span> <span class="nn">xl</span>

<span class="c1"># Training task</span>
<span class="n">ffm_model</span> <span class="o">=</span> <span class="n">xl</span><span class="o">.</span><span class="n">create_ffm</span><span class="p">()</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">setTrain</span><span class="p">(</span><span class="s2">&quot;./small_train.txt&quot;</span><span class="p">)</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.002</span><span class="p">,</span> <span class="s1">&#39;epoch&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">}</span>

<span class="n">ffm_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="s2">&quot;./model.out&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Start</span> <span class="n">to</span> <span class="n">train</span> <span class="o">...</span>
<span class="n">Epoch</span>      <span class="n">Train</span> <span class="n">log_loss</span>       <span class="n">Test</span> <span class="n">log_loss</span>     <span class="n">Time</span> <span class="n">cost</span> <span class="p">(</span><span class="n">sec</span><span class="p">)</span>
    <span class="mi">1</span>            <span class="mf">0.596511</span>            <span class="mf">0.541254</span>                <span class="mf">0.00</span>
    <span class="mi">2</span>            <span class="mf">0.536490</span>            <span class="mf">0.547355</span>                <span class="mf">0.00</span>
    <span class="mi">3</span>            <span class="mf">0.520169</span>            <span class="mf">0.531791</span>                <span class="mf">0.00</span>
    <span class="mi">4</span>            <span class="mf">0.506654</span>            <span class="mf">0.535538</span>                <span class="mf">0.00</span>
    <span class="mi">5</span>            <span class="mf">0.493861</span>            <span class="mf">0.533926</span>                <span class="mf">0.00</span>
    <span class="mi">6</span>            <span class="mf">0.481926</span>            <span class="mf">0.535290</span>                <span class="mf">0.00</span>
    <span class="mi">7</span>            <span class="mf">0.468731</span>            <span class="mf">0.527707</span>                <span class="mf">0.00</span>
    <span class="mi">8</span>            <span class="mf">0.465345</span>            <span class="mf">0.533434</span>                <span class="mf">0.00</span>
    <span class="mi">9</span>            <span class="mf">0.456871</span>            <span class="mf">0.534466</span>                <span class="mf">0.00</span>
<span class="n">Early</span><span class="o">-</span><span class="n">stopping</span> <span class="n">at</span> <span class="n">epoch</span> <span class="mi">7</span>
<span class="n">Start</span> <span class="n">to</span> <span class="n">save</span> <span class="n">model</span> <span class="o">...</span>
</pre></div>
</div>
<p>In this example, xLearn stops at the 7th epoch. Users can disable early stopping by using
<code class="docutils literal"><span class="pre">disableEarlyStop()</span></code> API.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xlearn</span> <span class="k">as</span> <span class="nn">xl</span>

<span class="c1"># Training task</span>
<span class="n">ffm_model</span> <span class="o">=</span> <span class="n">xl</span><span class="o">.</span><span class="n">create_ffm</span><span class="p">()</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">setTrain</span><span class="p">(</span><span class="s2">&quot;./small_train.txt&quot;</span><span class="p">)</span>
<span class="n">ffm_model</span><span class="o">.</span><span class="n">disableEarlyStop</span><span class="p">()</span>
<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.002</span><span class="p">,</span> <span class="s1">&#39;epoch&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">}</span>

<span class="n">ffm_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="s2">&quot;./model.out&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this time, xLearn performs 15 epoch.</p>
</div>
<div class="section" id="lock-free-training">
<h2>Lock-Free Training<a class="headerlink" href="#lock-free-training" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="instance-wise-normalization">
<h2>Instance-Wise Normalization<a class="headerlink" href="#instance-wise-normalization" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="quiet-training">
<h2>Quiet Training<a class="headerlink" href="#quiet-training" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="toctree-wrapper compound">
</div>
</div></blockquote>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="demo.html" class="btn btn-neutral float-right" title="xLearn Demo" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="command_line.html" class="btn btn-neutral" title="xLearn Command Line Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Chao Ma.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>